# Как интерфейсы работают в памяти в Go


---

## Пример кода

```go
type Speaker interface {
    SayHello()
}

type Human struct {
    Greeting string
}

func (h Human) SayHello() {
    fmt.Println(h.Greeting)
}

func main() {
    var s Speaker
    h := Human{Greeting: "Hello"}
    s = Speaker(h)
    s.SayHello()
}
```

---

## Как интерфейс представлен в памяти?

Интерфейс в Go состоит из двух частей:
1. **Указатель на таблицу методов (itable)**.
2. **Указатель на данные (data)**.

### 1. **Таблица методов (itable)**

Таблица методов (itable) содержит информацию о типе, который реализует интерфейс, и список методов, которые должны быть вызваны. Для каждого интерфейса и типа, который его реализует, Go создаёт отдельную таблицу методов.

В вашем примере:
- Интерфейс: `Speaker`.
- Тип: `Human`.

Go создаёт таблицу методов для пары `(Speaker, Human)`, которая содержит:
- Указатель на тип `Human`.
- Указатель на метод `SayHello` типа `Human`.

### 2. **Указатель на данные (data)**

Указатель на данные (data) ссылается на конкретный объект, который реализует интерфейс. В вашем примере это объект типа `Human`.

---

## Как это работает в вашем коде?

1. **Создание объекта `Human`:**

   ```go
   h := Human{Greeting: "Hello"}
   ```

   В памяти создаётся объект типа `Human` с полем `Greeting`, содержащим строку `"Hello"`.

2. **Присваивание интерфейсу:**

   ```go
   s = Speaker(h)
   ```

   Здесь происходит следующее:
    - Go создаёт таблицу методов `itable` для пары `(Speaker, Human)`.
    - Указатель на данные `data` устанавливается на объект `h`.

   Теперь переменная `s` содержит:
    - Указатель на таблицу методов `itable`, которая знает, что тип `Human` реализует интерфейс `Speaker` и содержит метод `SayHello`.
    - Указатель на объект `h`.

3. **Вызов метода через интерфейс:**

   ```go
   s.SayHello()
   ```

   Go использует таблицу методов `itable`, чтобы найти метод `SayHello` для типа `Human`, и вызывает его, передавая указатель на объект `h` в качестве получателя (`receiver`).

---

## Визуализация в памяти

```
s (Speaker)
+-------------------+
| itable            | --> itable(Speaker, Human)
|                   |     +-------------------+
|                   |     | type(Human)       |
|                   |     | ...               |
|                   |     | fun[0] = (Human).SayHello |
|                   |     +-------------------+
| data              | --> h (Human)
+-------------------+     +-------------------+
                          | Greeting: "Hello" |
                          +-------------------+
```

---

## Итог

- Интерфейс в Go состоит из двух частей: **таблицы методов (itable)** и **указателя на данные (data)**.
- Таблица методов содержит информацию о типе и методах, которые он реализует.
- Указатель на данные ссылается на конкретный объект, который реализует интерфейс.
- Когда вы вызываете метод через интерфейс, Go использует таблицу методов, чтобы найти правильный метод и передать ему данные.

