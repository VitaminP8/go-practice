# `sync.Cond` в Go: Условные переменные для синхронизации

**`sync.Cond`** — это примитив синхронизации в Go, который позволяет горутинам ждать или сигнализировать о выполнении определенных условий. Он полезен в сценариях, где горутины должны координировать свои действия на основе изменений состояния.

---

## Основное использование

`sync.Cond` имеет три основных метода:
1. **`Wait()`**:
    - Приостанавливает выполнение горутины до тех пор, пока не будет получен сигнал или широковещательное уведомление.
2. **`Signal()`**:
    - Пробуждает одну горутину, ожидающую на этом условии.
3. **`Broadcast()`**:
    - Пробуждает все горутины, ожидающие на этом условии.

`sync.Cond` всегда используется вместе с мьютексом (`sync.Mutex` или `sync.RWMutex`), который защищает доступ к общему состоянию.

---

### Пример использования

```go
package main

import (
	"fmt"
	"sync"
	"time"
)

func main() {
	var mu sync.Mutex
	cond := sync.NewCond(&mu)
	var ready bool

	// Горутина, которая ждет сигнала
	go func() {
		mu.Lock()
		for !ready {
			cond.Wait() // Ждем, пока ready не станет true
		}
		fmt.Println("Горутина: условие выполнено!")
		mu.Unlock()
	}()

	// Имитация работы
	time.Sleep(1 * time.Second)

	// Устанавливаем условие и сигнализируем
	mu.Lock()
	ready = true
	cond.Signal() // Пробуждаем одну горутину
	mu.Unlock()

	time.Sleep(1 * time.Second)
}
```

#### Вывод:
```
Горутина: условие выполнено!
```

---

## Как это работает?

1. **Инициализация**:
    - `cond := sync.NewCond(&mu)` создает новое условие, связанное с мьютексом `mu`.

2. **Ожидание**:
    - Горутина вызывает `cond.Wait()`, чтобы приостановить выполнение до получения сигнала.
    - Перед вызовом `Wait()` мьютекс должен быть заблокирован. `Wait()` автоматически разблокирует мьютекс и приостанавливает горутину.

3. **Сигнализация**:
    - Горутина вызывает `cond.Signal()` или `cond.Broadcast()`, чтобы пробудить одну или все ожидающие горутины.
    - Мьютекс должен быть заблокирован при вызове `Signal()` или `Broadcast()`.

4. **Продолжение выполнения**:
    - После пробуждения горутина снова блокирует мьютекс и продолжает выполнение.

---

## Особенности

1. **Использование с мьютексом**:
    - `sync.Cond` всегда используется вместе с мьютексом, который защищает доступ к общему состоянию.

2. **Широковещательное уведомление**:
    - `Broadcast()` пробуждает все ожидающие горутины, что полезно в сценариях, где несколько горутин должны реагировать на изменение состояния.

3. **Проверка условия**:
    - Перед вызовом `Wait()` всегда проверяйте условие в цикле. Это защищает от ложных пробуждений (spurious wakeups).

---


## Когда использовать `sync.Cond`?

- **Координация горутин**:
    - Если горутины должны ждать выполнения определенных условий перед продолжением работы.

- **Ожидание изменений состояния**:
    - Если горутины должны реагировать на изменения в общем состоянии.

- **Широковещательные уведомления**:
    - Если несколько горутин должны быть уведомлены об изменении состояния одновременно.

---

## Заключение

- **`sync.Cond`** — это мощный инструмент для синхронизации горутин на основе условий.
- Используйте `Wait()` для приостановки выполнения, `Signal()` для пробуждения одной горутины и `Broadcast()` для пробуждения всех горутин.
- Всегда используйте `sync.Cond` вместе с мьютексом для защиты доступа к общему состоянию.
